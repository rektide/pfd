{"id":"pfd-9mj","title":"Create socket-discovery crate","description":"Extract socket discovery logic from pfc into a shared crate for socket discovery strategies.\n\n**Scope:**\n- Create new crate `socket-discovery` in workspace\n- Move local file socket discovery from pfc/socket.rs\n- Define trait-based strategy interface\n- Implement local strategy (./pfd.sock, ./.pfd.sock)\n- Add CLI/env var priority handling\n\n**Future work (NOT in this ticket):**\n- XDG runtime strategy\n- XDG project strategy  \n- Composite strategy\n- Strategy parameter CLI flag\n\n**Acceptance:**\n- Workspace builds with new socket-discovery crate\n- pfc uses socket-discovery crate\n- Tests verify socket discovery works","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T02:24:00.532775995-05:00","updated_at":"2026-01-16T02:24:00.532775995-05:00"}
{"id":"pfd-daemon","title":"PFD-DAEMON: Server that receives and executes commands","description":"PreFork Daemon (PFD) - the long-running server that receives execution contexts and file descriptors, then executes commands.\n\nResponsibilities:\n- Accept Unix domain socket connections\n- Receive file descriptors via ancillary data\n- Parse and validate execution context\n- Execute commands with provided resources\n- Manage daemon lifecycle (double-fork, PID files)\n- Support auto-launch functionality\n\nInitial command: `add` - sum all arguments, complain on stderr","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-15T19:56:52.727849614-05:00","created_by":"rektide","updated_at":"2026-01-15T19:57:30.908901034-05:00"}
{"id":"pfd-daemon-lifecycle","title":"DAEMON-LIFECYCLE: Daemon lifecycle management subsystem","description":"Daemon process lifecycle management for background operations.\n\n**Components:**\n- Double-fork daemonization for true background process\n- PID file creation and locking in XDG locations\n- Process group management\n- Signal handling for graceful shutdown\n- Daemon health checking via PID files\n- Auto-launch daemon functionality (--create/-C flag)\n\n**Lifecycle:**\n1. Spawn via double-fork\n2. Create PID file in XDG location with lock\n3. Start Unix domain socket listener\n4. Accept execution contexts from clients\n5. Handle signals (SIGTERM, SIGINT) for clean shutdown\n6. Cleanup PID file on exit\n\n**Guarantees:**\n- Single instance enforcement via PID lock\n- Clean termination of active executions\n- Proper cleanup of resources on exit","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T19:55:49.835983071-05:00","created_by":"rektide","updated_at":"2026-01-15T20:26:26.620655038-05:00","dependencies":[{"issue_id":"pfd-daemon-lifecycle","depends_on_id":"pfd-irg","type":"parent-child","created_at":"2026-01-15T19:55:59.597266579-05:00","created_by":"rektide"},{"issue_id":"pfd-daemon-lifecycle","depends_on_id":"pfd-foundation","type":"parent-child","created_at":"2026-01-15T19:57:34.845329199-05:00","created_by":"rektide"}]}
{"id":"pfd-execution-context","title":"EXECUTION-CONTEXT: Execution context serialization subsystem","description":"Execution context serialization and validation.\n\n**Components:**\n- Serialization format for socket transfer (bincode)\n- Working directory validation and change\n- Argument array encoding and validation\n- Security validation before execution\n- Descriptor mapping and restoration\n\n**Flow:**\n1. Client serializes execution context\n2. Transfer over Unix socket with ancillary data\n3. Daemon receives and validates context\n4. Change to working directory\n5. Spawn child process with transferred descriptors\n6. Execute command with provided arguments","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T19:55:51.869259921-05:00","created_by":"rektide","updated_at":"2026-01-15T20:26:26.101211828-05:00","dependencies":[{"issue_id":"pfd-execution-context","depends_on_id":"pfd-irg","type":"parent-child","created_at":"2026-01-15T19:56:00.037267115-05:00","created_by":"rektide"},{"issue_id":"pfd-execution-context","depends_on_id":"pfd-foundation","type":"parent-child","created_at":"2026-01-15T19:57:35.164850576-05:00","created_by":"rektide"}]}
{"id":"pfd-fd-transfer","title":"FD-TRANSFER: Crate for file descriptor transfer","description":"Crate library for file descriptor transfer over Unix domain sockets.\n\nThis library provides safe, ergonomic file descriptor passing using ancillary data:\n\n**Capabilities:**\n- Send/receive multiple file descriptors atomically\n- Unix domain socket wrapper with ancillary data support\n- Descriptor lifecycle and ownership management\n- Error handling for partial/failed transfers\n- Zero-copy descriptor passing where possible\n\n**API Goals:**\n- Simple `send_fds(\u0026socket, \u0026[FileDescriptor])` interface\n- `recv_fds(\u0026socket) -\u003e Result\u003cVec\u003cFileDescriptor\u003e\u003e`\n- Atomic transfer guarantees for multiple descriptors\n- Clear error types for debugging transfer failures\n\n**Use Cases:**\n- Passing stdin/stdout/stderr between processes\n- Transferring arbitrary file handles (files, sockets, pipes)\n- Pre-fork daemon patterns where child needs parent's resources\n\nBased on `sendfd` crate research but with higher-level API and better ergonomics.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-15T20:04:41.268913372-05:00","created_by":"rektide","updated_at":"2026-01-15T20:04:41.268913372-05:00"}
{"id":"pfd-fd-transfer-subsystem","title":"FD-TRANSFER: File descriptor transfer subsystem","description":"File descriptor transfer over Unix domain sockets using ancillary data.\n\nThis subsystem provides safe, ergonomic fd passing:\n\n**Components:**\n- Unix domain socket wrapper with ancillary data support\n- Send/receive multiple file descriptors atomically\n- Descriptor lifecycle and ownership management\n- Error handling for partial/failed transfers\n\n**API:**\n- `send_fds(\u0026socket, \u0026[FileDescriptor])` interface\n- `recv_fds(\u0026socket) -\u003e Result\u003cVec\u003cFileDescriptor\u003e\u003e`\n- Clear error types for debugging transfer failures\n\n**Use Cases:**\n- Passing stdin/stdout/stderr between client and daemon\n- Transferring arbitrary file handles (files, sockets, pipes)\n\nBased on `sendfd` crate but with higher-level API and better ergonomics.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T19:55:44.971221163-05:00","created_by":"rektide","updated_at":"2026-01-15T20:10:50.460876403-05:00","dependencies":[{"issue_id":"pfd-fd-transfer-subsystem","depends_on_id":"pfd-foundation","type":"parent-child","created_at":"2026-01-15T19:57:33.990776336-05:00","created_by":"rektide"},{"issue_id":"pfd-fd-transfer-subsystem","depends_on_id":"pfd-fd-transfer","type":"parent-child","created_at":"2026-01-15T20:26:03.813025543-05:00","created_by":"rektide"}]}
{"id":"pfd-foundation","title":"FOUNDATION: Foundation subsystems and base infrastructure","description":"Foundation research for the entire prefork system. This epic contains all research tickets needed to understand the technologies and patterns we'll use.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-15T19:56:36.330593628-05:00","created_by":"rektide","updated_at":"2026-01-15T20:26:09.279057507-05:00"}
{"id":"pfd-irg","title":"prefork-democli: Build pre-fork daemon and client system","description":"A client/server pre-fork system for Rust:\n- `pfd` (daemon): Receives execution contexts and file descriptors, runs commands\n- `pfc` (client): Transfers execution context to daemon and terminates\n\nExecution context includes: command, args, cwd, and file descriptors (stdin/stdout/stderr)\n\nKey features:\n- File descriptor transfer via Unix domain sockets\n- Multiple discovery strategies (local, XDG, XDG-project)\n- Auto-launch daemon on demand\n- Minimal client footprint","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-15T19:54:39.24530666-05:00","created_by":"rektide","updated_at":"2026-01-15T19:57:38.973895509-05:00","closed_at":"2026-01-15T19:57:38.973895509-05:00","close_reason":"Replaced with better structured epics: Research (prefork-rs-gc3), PFD-DAEMON (prefork-rs-ufj), PFC-CLIENT (prefork-rs-ksn)"}
{"id":"pfd-pfc-client","title":"PFC-CLIENT: Minimal client for execution transfer","description":"PreFork Client (PFC) - minimal lightweight client that transfers execution context to daemon.\n\nPhilosophy: Keep client incredibly small and simple. Find daemon quickly, transfer context, terminate.\n\nResponsibilities:\n- Socket discovery with multiple strategies\n- Auto-launch daemon if not found (--create flag)\n- Serialize execution context\n- Transfer context and file descriptors via socket\n- Minimal error handling and feedback","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-15T19:56:54.737220413-05:00","created_by":"rektide","updated_at":"2026-01-15T19:57:31.346891819-05:00"}
{"id":"pfd-socket-discovery","title":"SOCKET-DISCOVERY: Crate for Unix domain socket discovery","description":"Crate library for Unix domain socket discovery across multiple strategies.\n\nThis library provides flexible socket location finding for daemons:\n\n**Discovery Strategies:**\n- Local file mode: `./pfd.sock` or `.pfd.sock`\n- XDG runtime mode: `$XDG_RUNTIME_DIR/pfd.sock`\n- XDG-project mode: `$XDG_RUNTIME_DIR/pfd.\u003cproject-name\u003e.sock`\n\n**Features:**\n- Fallback strategy configuration\n- Atomic socket file creation\n- Socket file permission management\n- Project name extraction and validation\n- Cross-platform XDG path handling via `directories` crate\n\n**Usage:**\nDaemon creates socket with configured mode. Client searches through strategies in priority order to find active daemon.\n\nGoal: Reusable crate for any daemon that needs flexible Unix domain socket discovery.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-15T20:04:35.061084212-05:00","created_by":"rektide","updated_at":"2026-01-15T20:04:35.061084212-05:00"}
{"id":"pfd-socket-discovery-strategy-composite","title":"COMPOSITE-STRATEGY: Composite discovery strategy","description":"Composite strategy that tries multiple discovery strategies in priority order.\n\n**Strategy:**\n- Try strategies in configured order until first success\n- Configurable priority list (local, xdg-runtime, xdg-project)\n- Returns first socket that accepts connection\n- Supports fallback and graceful degradation\n\n**Use Case:**\nFlexible discovery across deployment scenarios. Client can try local first, then XDG locations, ensuring daemon found wherever configured.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T22:29:43.799848323-05:00","created_by":"rektide","updated_at":"2026-01-15T22:29:43.799848323-05:00","dependencies":[{"issue_id":"pfd-socket-discovery-strategy-composite","depends_on_id":"pfd-socket-discovery","type":"parent-child","created_at":"2026-01-15T22:29:57.787944106-05:00","created_by":"rektide"}]}
{"id":"pfd-socket-discovery-strategy-local-file","title":"LOCAL-FILE: Local file socket discovery strategy","description":"Discover Unix domain socket in current working directory.\n\n**Strategies:**\n- Look for `./pfd.sock` in current directory\n- Look for `.pfd.sock` as fallback\n- Returns first valid socket found\n\n**Use Case:**\nDaemon creates socket in project directory. Client running in same directory finds it quickly without configuration.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T20:54:37.400299538-05:00","created_by":"rektide","updated_at":"2026-01-16T00:30:18.993847231-05:00","dependencies":[{"issue_id":"pfd-socket-discovery-strategy-local-file","depends_on_id":"pfd-socket-discovery","type":"parent-child","created_at":"2026-01-15T20:54:37.401466813-05:00","created_by":"rektide"}]}
{"id":"pfd-socket-discovery-strategy-param","title":"STRATEGY-PARAM: Command-line strategy parameter","description":"Command-line parameter for configuring discovery strategies.\n\n**Features:**\n- Accept comma-separated list of strategies: `--strategy local,xdg-runtime,xdg-project`\n- Parse and validate strategy list\n- Pass strategy configuration to discovery subsystem\n- Support strategy aliases for convenience\n\n**Use Case:**\nUser can customize discovery order based on their deployment setup. Example development uses local, production uses XDG.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T22:29:43.812191948-05:00","created_by":"rektide","updated_at":"2026-01-15T22:29:43.812191948-05:00","dependencies":[{"issue_id":"pfd-socket-discovery-strategy-param","depends_on_id":"pfd-socket-discovery","type":"parent-child","created_at":"2026-01-15T22:29:57.800735352-05:00","created_by":"rektide"}]}
{"id":"pfd-socket-discovery-strategy-xdg-project","title":"XDG-PROJECT: XDG project-scoped socket discovery strategy","description":"Discover Unix domain socket with project name prefix in XDG runtime.\n\n**Strategy:**\n- Look for `/run/user/1000/pfd.\u003cproject-name\u003e.sock`\n- Accepts project name parameter for scoping\n- Prevents socket conflicts between multiple projects\n\n**Use Case:**\nMultiple daemons running simultaneously for different projects, each with isolated socket.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T22:29:43.786305609-05:00","created_by":"rektide","updated_at":"2026-01-15T22:29:43.786305609-05:00","dependencies":[{"issue_id":"pfd-socket-discovery-strategy-xdg-project","depends_on_id":"pfd-socket-discovery","type":"parent-child","created_at":"2026-01-15T22:29:57.774961567-05:00","created_by":"rektide"}]}
{"id":"pfd-socket-discovery-strategy-xdg-runtime","title":"XDG-RUNTIME: XDG runtime directory socket discovery strategy","description":"Discover Unix domain socket in XDG runtime directory.\n\n**Strategy:**\n- Look for `/run/user/1000/pfd.sock`\n- Uses Rust `directories` crate for XDG path resolution\n- Cross-platform XDG compliant directory handling\n\n**Use Case:**\nDaemon creates socket in user runtime directory. Works across all projects running under same user account.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T22:29:43.770534323-05:00","created_by":"rektide","updated_at":"2026-01-15T22:29:43.770534323-05:00","dependencies":[{"issue_id":"pfd-socket-discovery-strategy-xdg-runtime","depends_on_id":"pfd-socket-discovery","type":"parent-child","created_at":"2026-01-15T22:29:57.758472654-05:00","created_by":"rektide"}]}
{"id":"pfd-socket-discovery-subsystem","title":"SOCKET-DISCOVERY: Unix domain socket discovery subsystem","description":"Unix domain socket discovery for finding daemon sockets.\n\n**Discovery Strategies:**\n- Local file mode: `./pfd.sock` or `.pfd.sock`\n- XDG runtime mode: `$XDG_RUNTIME_DIR/pfd.sock`\n- XDG-project mode: `$XDG_RUNTIME_DIR/pfd.\u003cproject-name\u003e.sock`\n\n**Components:**\n- Strategy configuration and priority ordering\n- Atomic socket file creation and detection\n- Socket file permission management\n- Project name extraction and validation\n- Cross-platform XDG path handling via `directories` crate\n\n**Behavior:**\nDaemon creates socket with configured mode. Client searches through strategies in priority order to find active daemon. Returns first successful connection.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T19:55:48.506481935-05:00","created_by":"rektide","updated_at":"2026-01-15T20:26:27.136744901-05:00","dependencies":[{"issue_id":"pfd-socket-discovery-subsystem","depends_on_id":"pfd-irg","type":"parent-child","created_at":"2026-01-15T19:55:59.120229169-05:00","created_by":"rektide"},{"issue_id":"pfd-socket-discovery-subsystem","depends_on_id":"pfd-foundation","type":"parent-child","created_at":"2026-01-15T19:57:34.450907234-05:00","created_by":"rektide"},{"issue_id":"pfd-socket-discovery-subsystem","depends_on_id":"pfd-socket-discovery","type":"parent-child","created_at":"2026-01-15T20:26:04.383037806-05:00","created_by":"rektide"}]}
